BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Discourse//<%= Discourse.current_hostname %>//<%= Discourse.full_version %>//EN
<% @events.each do |event| %>
BEGIN:VEVENT
UID:calendar_post_#<%= event.id %>@<%= Discourse.current_hostname %>
DTSTAMP:<%= Time.now.utc.strftime("%Y%m%dT%H%M%SZ") %>
DTSTART:<%= event.start_date.strftime("%Y%m%dT%H%M%SZ") %>
DTEND:<%= event.end_date.presence ? event.end_date.strftime("%Y%m%dT%H%M%SZ") : (event.start_date + 1.day).strftime("%Y%m%dT%H%M%SZ") %>
SUMMARY:<%= event.description %>
DESCRIPTION:<%= "#{PrettyText.format_for_email(event.post.excerpt, event.post).html_safe}\\n\\n#{Discourse.base_url}/t/-/#{event.post.topic_id}/#{event.post.post_number}" %>
URL:<%= Discourse.base_url %>/t/-/<%= event.post.topic_id %>/<%= event.post.post_number %>
END:VEVENT
<% end %>
END:VCALENDAR
