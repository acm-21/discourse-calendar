BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Discourse//<%= Discourse.current_hostname %>//<%= Discourse.full_version %>//EN
<% @events.each_with_index do |event, index| %>
BEGIN:VEVENT
UID:post_dates_#<%= index %>@<%= Discourse.current_hostname %>
DTSTAMP:<%= Time.now.utc.strftime("%Y%m%dT%H%M%SZ") %>
DTSTART:<%= event.start_date.strftime("%Y%m%dT%H%M%SZ") %>
DTEND:<%= event.end_date.presence ? event.end_date.strftime("%Y%m%dT%H%M%SZ") : (event.start_date + 1.hour).strftime("%Y%m%dT%H%M%SZ") %>
SUMMARY:<%= event.description %>
DESCRIPTION:<%= "#{event.description}\\n\\n#{Discourse.base_url}/t/-/#{event.post.topic_id}/#{event.post.post_number}" %>
URL:<%= Discourse.base_url %>/t/-/<%= event.post.topic_id %>/<%= event.post.post_number %>
END:VEVENT
<% end %>
END:VCALENDAR
